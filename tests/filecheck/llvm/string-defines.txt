; Test functionality of -D option: string variables are defined to the right
; value and CHECK directives using them match as expected given the value set.

; String variable correctly defined to a non-empty string.
RUN: FileCheck -DVALUE=10 --input-file %s %s
RUN: %ProtectFileCheckOutput not FileCheck -DVALUE=20 --input-file %s %s 2>&1 \
RUN:   | FileCheck %s --check-prefix ERRMSG
RUN: %ProtectFileCheckOutput \
RUN: not FileCheck -DVALUE=10 --check-prefix NOT --input-file %s %s 2>&1 \
RUN:   | FileCheck %s --check-prefix NOT-ERRMSG
RUN: FileCheck -DVALUE=20 --check-prefix NOT --input-file %s %s

Value = 10
CHECK: Value = [[VALUE]]
NOT-NOT: Value = [[VALUE]]

ERRMSG: no matches were found for expected pattern{{[[:space:]].*}}string-defines.txt:[[@LINE-3]]:8
ERRMSG-NEXT: [[@LINE-5]] │ Value = 10
ERRMSG-NEXT: [[@LINE-5]] │ CHECK{{:}} Value = {{\[\[VALUE\]\]}}
ERRMSG-NEXT: ────────┬────────
ERRMSG-NEXT:         ╰── pattern at this location was not matched


NOT-ERRMSG: match found, but was excluded{{[[:space:]].*}}string-defines.txt:[[@LINE-11]]:1
NOT-ERRMSG-NEXT: [[@LINE-23]] │
NOT-ERRMSG-NEXT: [[@LINE-23]] │ Value = 10
NOT-ERRMSG-NEXT: ─────┬────
NOT-ERRMSG-NEXT:      ╰── match found here

; Definition of string variable to an empty string.
RUN: FileCheck -DVALUE= --check-prefix EMPTY --input-file %s %s 2>&1

Empty value = @@
EMPTY: Empty value = @[[VALUE]]@
