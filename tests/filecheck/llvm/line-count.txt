; RUN: FileCheck --input-file %s %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD1 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR1 %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD2 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR2 %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD3 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR3 %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD4 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR4 %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD5 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR5 %s
; RUN: %ProtectFileCheckOutput not FileCheck --check-prefix BAD6 --input-file %s %s 2>&1 | FileCheck --check-prefix ERR6 %s

9 aaa
10 bbb
11 ccc
CHECK: [[@LINE-3]] {{a}}aa
CHECK: [[@LINE-3]] {{b}}bb
CHECK: [[@LINE-3]] {{c}}cc

16 foobar
CHECK: [[@LINE-1]] {{foo}}bar

19 arst CHECK: [[@LINE]] {{a}}rst

BAD1: [[@LINE:cant-have-regex]]
ERR1: unrecognized token{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:14

BAD2: [[@LIN]]
ERR2: reference to undefined variable 'LIN'{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:9

BAD3: [[@LINE*2]]
ERR3: unexpected character '*'{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:14
ERR3-NEXT: [[@LINE-3]] │
ERR3-NEXT{LITERAL}: [[@LINE*2]]
ERR3-NEXT:                 ┬
ERR3-NEXT:                 ╰── '*' is not valid here

BAD4: [[@LINE-x]]
ERR4: reference to undefined variable 'x'{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:15
ERR4-NEXT: [[@LINE-3]] │
ERR4-NEXT{LITERAL}: [[@LINE-x]]
ERR4-NEXT:                  ┬
ERR4-NEXT:                  ╰── occurs here

BAD5: [[@LINE-1x]]
ERR5: unrecognized token{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:16
ERR5-NEXT: [[@LINE-3]] │
ERR5-NEXT{LITERAL}: [[@LINE-1x]]
ERR5-NEXT:                   ┬
ERR5-NEXT:                   ╰── lexed a x here
ERR5: help: expected one of: "]]", "+", "-"

; RUN: %ProtectFileCheckOutput \
; RUN: not FileCheck --check-prefix BAD7 --input-file %s %s 2>&1 \
; RUN:   | FileCheck --check-prefix ERR7 %s

BAD6: [[#@LINE-1]] NOT HERE
ERR6: no matches were found for expected pattern{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:7
ERR6-NEXT: [[@LINE-3]] │
ERR6-NEXT{LITERAL}: [[#@LINE-1]] NOT HERE
ERR6-NEXT:          ──────────┬──────────
ERR6-NEXT:                    ╰── pattern at this location was not matched

; RUN: %ProtectFileCheckOutput \
; RUN: not FileCheck --check-prefix BAD7 --input-file %s %s 2>&1 \
; RUN:   | FileCheck --check-prefix ERR7 %s

BAD7: [[@LINE-0xA]]
ERR7: no matches were found for expected pattern{{[[:space:]].*}}line-count.txt:[[#@LINE-1]]:7
ERR7-NEXT: [[@LINE-3]] │
ERR7-NEXT{LITERAL}: [[@LINE-0xA]]
ERR7-NEXT:          ──────┬──────
ERR7-NEXT:                ╰── pattern at this location was not matched

71 CHECK: [[#@LINE]] CHECK
72 CHECK: [[# @LINE]] CHECK
73 CHECK: [[# @LINE ]] CHECK
74
75 CHECK: [[#@LINE-1]]
76 CHECK: [[# @LINE-1]] CHECK
77 CHECK: [[# @LINE -1]] CHECK
78 CHECK: [[# @LINE - 1]] CHECK
79 CHECK: [[# @LINE - 1 ]] CHECK
