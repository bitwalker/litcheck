# Bad comment prefixes are diagnosed.

# Check empty comment prefix.
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --comment-prefixes= | \
RUN:   FileCheck --check-prefix=PREFIX-EMPTY %s
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --comment-prefixes=,FOO | \
RUN:   FileCheck --check-prefix=PREFIX-EMPTY %s
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --comment-prefixes=FOO, | \
RUN:   FileCheck --check-prefix=PREFIX-EMPTY %s
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --comment-prefixes=FOO,,BAR | \
RUN:   FileCheck --check-prefix=PREFIX-EMPTY %s
PREFIX-EMPTY: error: supplied prefix must not be an empty string

# Check invalid characters in comment prefix.
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                       --comment-prefixes=. | \
RUN:   FileCheck --check-prefix=PREFIX-BAD-CHAR1 %s
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                       --comment-prefixes='foo ' | \
RUN:   FileCheck --check-prefix=PREFIX-BAD-CHAR2 %s
PREFIX-BAD-CHAR1: error: supplied prefix must start with an ASCII alphabetic character
PREFIX-BAD-CHAR2: error: supplied prefix may only contain ASCII alphanumerics, hyphens, or underscores

# Check user-supplied check prefix that duplicates a default comment prefix.
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --check-prefixes=FOO,COM | \
RUN:   FileCheck --check-prefix=CHECK-PREFIX-DUP-COM %s
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --check-prefixes=RUN,FOO | \
RUN:   FileCheck --check-prefix=CHECK-PREFIX-DUP-RUN_ %s
CHECK-PREFIX-DUP-COM: supplied check prefix must be unique among check and comment prefixes:
CHECK-PREFIX-DUP-COM-NEXT: 'COM'
CHECK-PREFIX-DUP-RUN_: supplied check prefix must be unique among check and comment prefixes:
CHECK-PREFIX-DUP-RUN_-NEXT: 'RUN'

# Check user-supplied comment prefix that duplicates default check prefixes.
RUN: %ProtectFileCheckOutput not FileCheck /dev/null < /dev/null 2>&1 \
RUN:                                      --comment-prefixes=CHECK | \
RUN:   FileCheck --check-prefix=COMMENT-PREFIX-DUP-CHECK %s
COMMENT-PREFIX-DUP-CHECK: supplied comment prefix must be unique among check and comment prefixes:
COMMENT-PREFIX-DUP-CHECK-NEXT: 'CHECK'
